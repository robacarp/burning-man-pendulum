<!DOCTYPE html>
<html>
  <head>
    <style type="text/css">
      body {
        background-color: #ddd;
        margin:0;
        padding:0;
        font-size:16px;
        line-height:1.3em;
        font-family:Georgia;
      }

      #controls {
        position: absolute;
        top:0;
        left:0;
        background-color:#ddd;
        padding:5px;
        border:1px solid #bbb;
      }
    </style>
    <script type="text/javascript">
      //gamma = 160 seconds
      //longest pendulum N = 51
      //

    //$GLOBALS
    var $canvas = null, $2d = null;

    //lists
    var $objects = [], $pendulums = [], $algorithms = [];
    //counters
    var $timer = 0, $ticker = 0;

    //parameters
    var $frame_delay = 25, $algorithm = 1;

    //flags
    var $movement = true, $colors = true;

    function setup(){
      $canvas = document.getElementById('canvas');
      $2d = canvas.getContext('2d');  // for later, maybe inspect the experimental-webgl context?

      // create the "horizon"
      $objects.push({
        draw: function(context){
          context.beginPath();
          context.moveTo(0,0);
          context.fillStyle = 'rgb(0,0,0)';
          context.lineTo($canvas.width, 0);
          context.lineTo($canvas.width, $canvas.height);
          context.lineTo(0, $canvas.height);
          context.lineTo(0,0);
          context.fill();

          var gradient = context.createLinearGradient(0,$canvas.height,0,0);
          gradient.addColorStop(0, 'rgb(60,100,180)');
          gradient.addColorStop(0.9, 'rgb(0,20,100)');
          context.fillStyle = gradient;
          var midline = 350;
          context.moveTo(0,midline);
          context.lineTo(0,$canvas.height);
          context.lineTo($canvas.width, $canvas.height);
          context.lineTo($canvas.width, midline);
          context.lineTo(0,midline);
          context.fill();
          context.closePath();
        }
      });

      // build out some pendulums
      var j;
      for (i = 0; i < 15; i ++) {
        j = new pendulum( 650, 100, i, 160, 51 - i )
        $pendulums.push( j );
      }

      for (i in $pendulums)
        $objects.push( $pendulums[i] );

      // hang the pendulums from a  "bar" at the top
      var b = new ball(650,100,5);
      b.fill = true;
      $objects.push( b );

      //make a picker for the algorithms
      var picker = document.getElementById('picker');
      for (i in $algorithms)
        picker.options[picker.options.length] = new Option($algorithms[i].name,i);

      //event the picker
      picker.onchange = function(e){
        $algorithm = e.target.options[e.target.selectedIndex].value;
      }


      draw();
      $timer = setInterval(draw, $frame_delay);
    }

    function draw(){

      $ticker ++;
      colorit();
      $2d.clearRect(0,0, $canvas.width,$canvas.height);
      for (i in $objects) {
        if ($movement && $objects[i].increment)
          $objects[i].increment();

        if ($objects[i].draw)
          $objects[i].draw($2d);
      }
    }

    function colorit(){
      if (!$colors) return;
      for (i in $pendulums){
        $algorithms[$algorithm]($pendulums[i].ball, i, $ticker);
      }
    }

    function sort(){
      for (i in $pendulums){
        $pendulums[i].angle = ((9 * i + 120) / 180) * Math.PI;
      }
    }

    function reinitialize(){
      for (i in $pendulums){
        $pendulums[i].initialize();
      }
    }

    onload = setup;
    </script>

    <script type="text/javascript" src="ball.js"></script>
    <script type="text/javascript" src="color.js"></script>
    <script type="text/javascript" src="pendulum.js"></script>
    <script type="text/javascript" src="point.js"></script>

    <!-- coloring algorithms -->
    <script type="text/javascript" src="black-white.js"></script>
    <script type="text/javascript" src="rainbow.js"></script>

  </head>
  <body>
    <div id="controls">
      Everything: <a href="javascript:clearInterval($timer);">Stop</a> <a href="javascript:clearInterval($timer); $timer = setInterval(draw, $frame_delay);">Run</a>
      <br>
      Movement: <a href="javascript:$movement = false;">Pause</a> <a href="javascript:$movement = true;">Play</a>
      <br>
      Position: <a href="javascript:sort();">Sort</a> <a href="javascript:reinitialize();">Reinit</a>
      <br>
      Colors: <a href="javascript:$colors = false;">Pause</a> <a href="javascript:$colors = true;">Play</a>
      <br>
      Coloring Algorithm: <select id="picker"></select>
    </div>
    <canvas id="canvas" width="1400" height="800"></canvas>
  </body>
</html>
